"use strict";(self.webpackChunktutorial=self.webpackChunktutorial||[]).push([[289],{3905:function(e,t,a){a.d(t,{Zo:function(){return p},kt:function(){return m}});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var i=r.createContext({}),c=function(e){var t=r.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},p=function(e){var t=c(e.components);return r.createElement(i.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,i=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(a),m=n,h=u["".concat(i,".").concat(m)]||u[m]||d[m]||o;return a?r.createElement(h,l(l({ref:t},p),{},{components:a})):r.createElement(h,l({ref:t},p))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,l=new Array(o);l[0]=u;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:n,l[1]=s;for(var c=2;c<o;c++)l[c]=a[c];return r.createElement.apply(null,l)}return r.createElement.apply(null,a)}u.displayName="MDXCreateElement"},2784:function(e,t,a){a.r(t),a.d(t,{assets:function(){return p},contentTitle:function(){return i},default:function(){return m},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return d}});var r=a(7462),n=a(3366),o=(a(7294),a(3905)),l=["components"],s={id:"run-local-server-database",title:"Run Local Server and Database",tags:["docker","prisma"]},i="Run Local Server and Database",c={unversionedId:"project-setup/run-local-server-database",id:"project-setup/run-local-server-database",title:"Run Local Server and Database",description:"The repository is setup to run our Apollo GraphQL Server and Postgres database in a docker container for local development.",source:"@site/docs/project-setup/run-local-server-database.md",sourceDirName:"project-setup",slug:"/project-setup/run-local-server-database",permalink:"/full-stack-next-tutorial/docs/project-setup/run-local-server-database",editUrl:"https://github.com/lbsonley/full-stack-next-tutorial/docs/project-setup/run-local-server-database.md",tags:[{label:"docker",permalink:"/full-stack-next-tutorial/docs/tags/docker"},{label:"prisma",permalink:"/full-stack-next-tutorial/docs/tags/prisma"}],version:"current",frontMatter:{id:"run-local-server-database",title:"Run Local Server and Database",tags:["docker","prisma"]},sidebar:"tutorialSidebar",previous:{title:"Backend Orientation",permalink:"/full-stack-next-tutorial/docs/project-setup/backend-orientation"}},p={},d=[{value:"Dockerfile and docker-compose.yml",id:"dockerfile-and-docker-composeyml",level:2},{value:"Start Docker Container",id:"start-docker-container",level:2},{value:"Apply Database Migrations",id:"apply-database-migrations",level:3},{value:"Seed Prisma Database",id:"seed-prisma-database",level:3},{value:"Explore Dev Tools",id:"explore-dev-tools",level:2}],u={toc:d};function m(e){var t=e.components,s=(0,n.Z)(e,l);return(0,o.kt)("wrapper",(0,r.Z)({},u,s,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"run-local-server-and-database"},"Run Local Server and Database"),(0,o.kt)("p",null,"The repository is setup to run our Apollo GraphQL Server and Postgres database in a docker container for local development."),(0,o.kt)("h2",{id:"dockerfile-and-docker-composeyml"},"Dockerfile and docker-compose.yml"),(0,o.kt)("p",null,"Before we run Docker, let's take a look at the ",(0,o.kt)("inlineCode",{parentName:"p"},"Dockerfile")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," to get a sense of what going on."),(0,o.kt)("p",null,"TODO -> Explain Docker configs"),(0,o.kt)("h2",{id:"start-docker-container"},"Start Docker Container"),(0,o.kt)("p",null,"To start the docker container, open a terminal in the ",(0,o.kt)("inlineCode",{parentName:"p"},"backend")," directory of the repository and run the following commands."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"# build the docker container\ndocker-compose build\n\n# run the docker container\ndocker-compose up -d\n")),(0,o.kt)("p",null,"The first time you start the docker containers, the databases will be empty. There are a couple of steps you need to take to apply the Prisma Schema to the database. First, you will need to create tables on the database for each model. Next, you will want to fill the database with some sample data."),(0,o.kt)("h3",{id:"apply-database-migrations"},"Apply Database Migrations"),(0,o.kt)("p",null,"Up until now, we have not really interacted with our Database. In fact, we haven't even had a running database. But now that our database is running inside of Docker, we can start adding data."),(0,o.kt)("p",null,'To do this, open a terminal inside of the "server" docker container.'),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"open terminal in docker container",src:a(1709).Z,width:"2326",height:"1424"})),(0,o.kt)("p",null,"Once inside the container, run the command to create tables defined in the prisma schema on the database:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"yarn prisma migrate deploy\n")),(0,o.kt)("p",null,"This should have created the ",(0,o.kt)("inlineCode",{parentName:"p"},"Users")," tables on the database."),(0,o.kt)("h3",{id:"seed-prisma-database"},"Seed Prisma Database"),(0,o.kt)("p",null,"Now that the ",(0,o.kt)("inlineCode",{parentName:"p"},"Users")," tables exists. We can add some sample data to our database. Prisma comes with a ",(0,o.kt)("inlineCode",{parentName:"p"},"db seed")," command that does exactly that. Inside of the server container terminal, run the command to add the seed data."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"yarn prisma db seed\n")),(0,o.kt)("p",null,"This command will look inside of ",(0,o.kt)("inlineCode",{parentName:"p"},"backend/package.json")," for a ",(0,o.kt)("inlineCode",{parentName:"p"},"prisma.seed")," property and execute the command defined there. Our ",(0,o.kt)("inlineCode",{parentName:"p"},"package.json")," defines this command as ",(0,o.kt)("inlineCode",{parentName:"p"},"ts-node prisma/seed/index.ts"),"."),(0,o.kt)("p",null,"If we take a look inside of that file, we will see that we import some sample data from ",(0,o.kt)("inlineCode",{parentName:"p"},"prisma/seed/data/users.ts"),". We also create a Prisma Client instance. We then loop through that data, calling ",(0,o.kt)("inlineCode",{parentName:"p"},"prisma.user.create()")," for each user."),(0,o.kt)("p",null,"For more information about seeding data, see the ",(0,o.kt)("a",{parentName:"p",href:"https://www.prisma.io/docs/guides/database/seed-database"},"Prisma Seed Docs")),(0,o.kt)("h2",{id:"explore-dev-tools"},"Explore Dev Tools"),(0,o.kt)("p",null,"Apollo Server comes with its own API explorer called Apollo Studio. You can see it by opening ",(0,o.kt)("a",{parentName:"p",href:"http://localhost:4000/graphql"},"http://localhost:4000/graphql")," in your browser."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Apollo Studio screenshot",src:a(3218).Z,width:"3172",height:"2354"})),(0,o.kt)("p",null,"Prisma also comes with its own database explorer tool called Prisma Studio. You can see it by opening ",(0,o.kt)("a",{parentName:"p",href:"http://localhost:5555"},"http://localhost:5555")," in your browser."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Prisma Studio screenshot",src:a(5051).Z,width:"2784",height:"1576"})))}m.isMDXComponent=!0},3218:function(e,t,a){t.Z=a.p+"assets/images/apollo-studio-a6e34fcf6774d3b631888d0303ece676.png"},1709:function(e,t,a){t.Z=a.p+"assets/images/docker-container-terminal-478b961e58f8b0e4d4bf83bd93336e2e.png"},5051:function(e,t,a){t.Z=a.p+"assets/images/prisma-studio-bfd920f53ad82dc92b38adc218600055.png"}}]);